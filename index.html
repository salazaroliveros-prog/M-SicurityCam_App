<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>M&S Security - Signal Decrypter</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.10/hls.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;600&display=swap');

            body {
                background: #000;
                color: #fff;
                font-family: 'Inter', sans-serif;
                margin: 0;
                overflow: auto;
                height: 100vh;
                width: 100vw;
                max-width: 100vw;
                max-height: 100vh;
                touch-action: manipulation;
            }

        /* Efecto de Matrix / SeÃ±al de Radio */
        .signal-wave {
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(34, 197, 94, 0.2);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
            animation: scan-line 4s infinite linear;
            z-index: 1;
        }

        @keyframes scan-line {
            0% { top: 0%; }
            100% { top: 100%; }
        }

        .decryption-log {
            font-family: 'Courier New', Courier, monospace;
            font-size: 10px;
            color: #22c55e;
            height: 100px;
            overflow: hidden;
            background: rgba(0,0,0,0.8);
            border: 1px solid rgba(34, 197, 94, 0.3);
            padding: 10px;
            border-radius: 8px;
        }

        .btn-scan {
            background: linear-gradient(135deg, #22c55e, #166534);
            transition: all 0.3s ease;
        }
        
        .btn-scan:active { transform: scale(0.95); filter: brightness(1.2); }

        .loading-ring {
            width: 150px;
            height: 150px;
            border: 2px solid transparent;
            border-top: 2px solid #22c55e;
            border-radius: 50%;
            animation: spin 1s infinite linear;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="decrypter-ui" class="h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
    <div class="signal-wave"></div>
    
    <!-- Pantalla de Escaneo de SeÃ±al -->
    <div id="scanner-view" class="z-10 w-full max-w-md flex flex-col items-center">
        <h1 class="font-orbitron text-2xl font-black mb-2 tracking-widest text-green-500">M&S DECRYPTER</h1>
        <p class="text-[10px] text-slate-500 uppercase tracking-[0.3em] mb-12">Analizador de Frecuencia y Latencia</p>

        <!-- Campo para ingresar la URL del stream de la cÃ¡mara -->
        <input id="camera-url" type="text" placeholder="URL del stream de la cÃ¡mara (http://...)" class="w-full mb-4 p-2 rounded bg-black border border-green-500 text-green-400 placeholder-green-700 text-xs" />

        <div class="relative flex items-center justify-center mb-12">
            <div id="loader" class="hidden loading-ring"></div>
            <div id="radar-icon" class="text-6xl">ðŸ“¡</div>
            <div id="progress-val" class="absolute -bottom-8 font-mono text-green-500 text-xs">0.00 MHz</div>
        </div>

        <div id="log" class="decryption-log w-full mb-8">
            > ESPERANDO INICIO DE ESCANEO...<br>
            > LISTO PARA CAPTURA DE PAQUETES RTSP/HLS...
        </div>

        <button id="scan-trigger" onclick="runDecryption()" class="btn-scan w-full py-5 rounded-2xl font-black uppercase text-xs tracking-widest shadow-[0_0_30px_rgba(34,197,94,0.3)]">
            INICIAR CAPTURA DE SEÃ‘AL
        </button>
    </div>

    <!-- Pantalla de ConexiÃ³n Exitosa -->
    <div id="success-view" class="hidden z-10 w-full max-w-md flex flex-col items-center">
        <div class="text-6xl mb-6">âœ…</div>
        <h2 class="font-orbitron text-xl font-bold mb-2">SEÃ‘AL DESCIFRADA</h2>
        <p id="result-ip" class="font-mono text-green-500 text-sm mb-12">IP: 192.168.1.45 | LAT: 12ms</p>
        <!-- Video de la cÃ¡mara -->
        <div id="video-container" class="w-full mb-6 flex flex-col items-center">
            <video id="camera-video" class="w-full rounded border border-green-500 bg-black" controls autoplay style="max-height:300px; display:none;"></video>
            <div id="video-error" class="text-red-500 text-xs mt-2 hidden">No se pudo cargar el video. Verifica la URL y el formato.</div>
        </div>
        <button onclick="window.location.reload()" class="w-full bg-white text-black py-5 rounded-2xl font-black uppercase text-xs tracking-widest">
            VINCULAR A PANEL PRINCIPAL
        </button>
    </div>
    <meta name="description" content="M&S Security Decrypter: seguro, privado y confiable.">
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href='data:application/json,{"name":"M&S Security","short_name":"MS-Cam","start_url":".","display":"standalone","background_color":"#000000","theme_color":"#22c55e"}'>
</div>

<script>
    const logEntries = [
        "Iniciando escaneo de puertos 80, 554, 8080...",
        "Capturando paquetes en frecuencia 2.441 GHz...",
        "Detectando latencia de red: 14ms (Estable)",
        "Analizando cabeceras de protocolo RTSP...",
        "Bypass de autenticaciÃ³n local intentado...",
        "Descifrando flujo HLS compatible...",
        "VÃ­nculo establecido con Nodo 01.",
        "Sincronizando reloj de transmisiÃ³n..."
    ];

    function runDecryption() {
        const btn = document.getElementById('scan-trigger');
        const loader = document.getElementById('loader');
        const radar = document.getElementById('radar-icon');
        const log = document.getElementById('log');
        const prog = document.getElementById('progress-val');
        const cameraUrlInput = document.getElementById('camera-url');
        window._cameraUrl = cameraUrlInput.value.trim();

        btn.disabled = true;
        btn.innerHTML = "DESCIFRANDO...";
        loader.classList.remove('hidden');
        radar.classList.add('animate-pulse');

        let i = 0;
        const interval = setInterval(() => {
            if (i < logEntries.length) {
                log.innerHTML += `> ${logEntries[i]}<br>`;
                log.scrollTop = log.scrollHeight;
                prog.innerText = (2400 + (Math.random() * 100)).toFixed(2) + " MHz";
                i++;
            } else {
                clearInterval(interval);
                showSuccess();
            }
        }, 1200);
    }

    function showSuccess() {
        document.getElementById('scanner-view').classList.add('hidden');
        document.getElementById('success-view').classList.remove('hidden');

        // SimulaciÃ³n de guardado de la IP "descifrada"
        const foundIP = `192.168.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`;
        document.getElementById('result-ip').innerText = `IP: ${foundIP} | LAT: ${Math.floor(Math.random()*20)}ms`;

        // Mostrar el video de la cÃ¡mara si se ingresÃ³ una URL
        const video = document.getElementById('camera-video');
        const videoError = document.getElementById('video-error');
        if (window._cameraUrl) {
            video.style.display = '';
            // Si es HLS (.m3u8), usar hls.js
            if (window._cameraUrl.endsWith('.m3u8')) {
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(window._cameraUrl);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.ERROR, function () {
                        videoError.classList.remove('hidden');
                        video.style.display = 'none';
                    });
                    video.oncanplay = function() {
                        videoError.classList.add('hidden');
                        video.style.display = '';
                    };
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = window._cameraUrl;
                    video.load();
                } else {
                    videoError.classList.remove('hidden');
                    video.style.display = 'none';
                }
            } else {
                // Para otros formatos (mp4, mjpeg, etc.)
                video.src = window._cameraUrl;
                video.load();
                video.onerror = function() {
                    videoError.classList.remove('hidden');
                    video.style.display = 'none';
                };
                video.oncanplay = function() {
                    videoError.classList.add('hidden');
                    video.style.display = '';
                };
            }
        } else {
            video.style.display = 'none';
            videoError.classList.add('hidden');
        }
    }
</script>
</body>
</html>